@page "/"
@layout Layout.FullScreenLayout
@using MissilPolice.Models
@using MissilPolice.Services
@inject CaseService CaseService

<div class="dashboard-screen" dir="rtl">
    <header class="topbar">
        <div class="brand">Missal Police</div>
@* Updating Home.razor to include Help Menu Dropdown *@
        <div class="top-actions">
            
            <div class="menu-item-container">
                <a href="#" class="menu-item @(isFileMenuOpen ? "active" : "")" @onclick="ToggleFileMenu" @onclick:preventDefault>فائل</a>
                @if (isFileMenuOpen)
                {
                    <div class="dropdown-menu show">
                        <a href="#" class="dropdown-item">
                             <span class="icon-placeholder">💾</span> ڈیٹا محفوظ کریں
                        </a>
                        <a href="#" class="dropdown-item highlight">
                            <span class="icon-placeholder">☁️</span> ڈیٹا اپ لوڈ کریں
                        </a>
                         <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item text-danger">
                            <span class="icon-placeholder">❌</span> بند کریں
                        </a>
                    </div>
                }
            </div>

            <div class="menu-item-container">
                <a href="#" class="menu-item @(isPrintMenuOpen ? "active" : "")" @onclick="TogglePrintMenu" @onclick:preventDefault>پرنٹ صفحات</a>
                @if (isPrintMenuOpen)
                {
                    <div class="dropdown-menu show" style="min-width: 180px;">
                        <label class="dropdown-item" style="cursor: pointer;">
                            <input type="checkbox" checked style="width: 16px; height: 16px; accent-color: var(--teal);" />
                            <span>A4 پرنٹ</span>
                        </label>
                        <label class="dropdown-item" style="cursor: pointer;">
                            <input type="checkbox" checked style="width: 16px; height: 16px; accent-color: var(--teal);" />
                            <span>لیگل پرنٹ</span>
                        </label>
                    </div>
                }
            </div>

            <div class="menu-item-container">
                 <a href="#" class="menu-item @(isHelpMenuOpen ? "active" : "")" @onclick="ToggleHelpMenu" @onclick:preventDefault>راہنمائی حاصل کریں</a>
                 @if (isHelpMenuOpen)
                 {
                     <div class="dropdown-menu show" style="min-width: 200px;">
                        <a href="#" class="dropdown-item">استعمال کا طریقہ</a>
                        <a href="#" class="dropdown-item highlight">برائے رابطہ</a>
                        <a href="#" class="dropdown-item">لنک شیئر کریں</a>
                        <a href="#" class="dropdown-item">سافٹ ویئر</a>
                        <a href="#" class="dropdown-item">رجسٹر</a>
                     </div>
                 }
            </div>
        </div>
    </header>

    <div class="dashboard-body">
        <aside class="side-panel">
            <div class="logo-card">
                <div class="logo-mark" aria-hidden="true" style="overflow: hidden;">
                    <img src="images/logo.png" alt="Missil Police Logo" style="width: 100%; height: 100%; object-fit: contain;" />
                </div>
                <div class="logo-text">
                    <div class="logo-title">Missal Police</div>
                    <div class="logo-subtitle">MISSAIL POLICE</div>
                </div>
            </div>

            <div class="side-actions">
                <NavLink class="side-action primary" href="case-new">
                    <span class="icon">+</span>
                    <span>FIR کا اندراج</span>
                </NavLink>
                <button class="side-action" type="button">
                    <span class="icon icon-refresh"></span>
                    <span>FIR میں تبدیلی</span>
                </button>
                <NavLink class="side-action" href="summary">
                    <span class="icon">+</span>
                    <span>تفصیل مقدمہ</span>
                </NavLink>
                <NavLink class="side-action" href="zext">
                    <span class="icon">i</span>
                    <span>ضروری معلومات</span>
                </NavLink>
                <button class="side-action ghost" type="button">
                    <span class="icon">≡</span>
                    <span>کمپیوٹرائزڈ مثل کیلنڈر</span>
                </button>
            </div>
        </aside>

        <section class="main-panel">
            <div class="stats-row">
                <button class="stat-card" type="button">
                    <div class="stat-value">@(cases?.Count(c => c.NEW == "Yes" || c.NEW == "true") ?? 0)</div>
                    <div class="stat-label">تفتیش جدید</div>
                </button>
                <button class="stat-card" type="button">
                    <div class="stat-value">@(cases?.Count(c => c.FIRSTATUS == "اخراج") ?? 0)</div>
                    <div class="stat-label">اخراج</div>
                </button>
                <button class="stat-card" type="button">
                    <div class="stat-value">@(cases?.Count(c => c.FIRSTATUS == "عدم پتہ") ?? 0)</div>
                    <div class="stat-label">عدم پتہ</div>
                </button>
                <button class="stat-card" type="button">
                    <div class="stat-value">@(cases?.Count(c => c.FIRSTATUS == "زیر تفتیش") ?? 0)</div>
                    <div class="stat-label">زیر تفتیش</div>
                </button>
                <div class="stat-connector"></div>
                <button class="stat-card" type="button">
                    <div class="stat-value">@(cases?.Count ?? 0)</div>
                    <div class="stat-label">کل مقدمات</div>
                </button>
                <button class="stat-card" type="button">
                    <div class="stat-value">@(cases?.Count(c => c.FIRSTATUS == "نامکمل چالان") ?? 0)</div>
                    <div class="stat-label">نامکمل چالان</div>
                </button>
                <button class="stat-card" type="button">
                    <div class="stat-value">@(cases?.Count(c => c.FIRSTATUS == "چالان 512") ?? 0)</div>
                    <div class="stat-label">چالان 512</div>
                </button>
                <button class="stat-card" type="button">
                    <div class="stat-value">@(cases?.Count(c => c.FIRSTATUS == "چالان") ?? 0)</div>
                    <div class="stat-label">چالان</div>
                </button>
            </div>

            <div class="search-row">
                <div class="timestamp">@DateTime.Now.ToString("dd MMM yyyy - dddd - hh:mm tt")</div>
                <div class="search-box">
                    <input type="text" placeholder="تلاش کریں" aria-label="تلاش کریں" />
                    <button type="button" title="تلاش">
                        <span class="icon icon-search" aria-hidden="true"></span>
                    </button>
                </div>
            </div>

            <div class="table-wrapper">
                <table class="case-table" aria-label="فہرست مقدمات">
                    <thead>
                        <tr>
                            <th>نمبر شمار</th>
                            <th>حذف</th>
                            <th>تبدیلی</th>
                            <th>مقدمہ نمبر</th>
                            <th>مورخہ</th>
                            <th>تھانہ</th>
                            <th>مدعی مقدمہ</th>
                            <th>موبائل نمبر</th>
                            <th>جرم</th>
                            <th>تفتیشی افسر</th>
                            <th>پوزیشن مقدمہ</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (cases == null)
                        {
                             <tr><td colspan="11" style="text-align:center; padding: 20px;">Loading data...</td></tr>
                        }
                        else if (!cases.Any())
                        {
                             <tr><td colspan="11" style="text-align:center; padding: 20px;">No cases found.</td></tr>
                        }
                        else
                        {
                            @foreach (var item in cases)
                            {
                                <tr class="@(selectedCase == item ? "selected" : "")" @onclick="() => SelectCase(item)">
                                    <td>@item.FIRID</td>
                                    <td>
                                        <button class="icon-btn" title="حذف" aria-label="حذف">
                                             <img src="images/delete.png" alt="Delete" style="width: 20px; height: 20px;" />
                                        </button>
                                    </td>
                                    <td>
                                        <button class="icon-btn" title="تبدیلی" aria-label="تبدیلی">
                                            <img src="images/update.png" alt="Edit" style="width: 20px; height: 20px;" />
                                        </button>
                                    </td>
                                    <td>@(item.FIRNO ?? "-")</td>
                                    <td>@(item.IDATE ?? item.FIRDATE)</td>
                                    <td>@(item.PS ?? "-")</td>
                                    <td>@(item.MUDAI ?? "-")</td>
                                    <td>@(item.FIRMOBILE ?? "-")</td>
                                    <td>@(item.OFFENCE ?? "-")</td>
                                    <td>@(item.IOFFICER ?? "-")</td>
                                    <td>@(item.FIRSTATUS ?? "زیر تفتیش")</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </section>
    </div>
</div>

@code {
    private List<Fir>? cases;
    private Fir selectedCase;
    private bool isFileMenuOpen = false;
    private bool isHelpMenuOpen = false;
    private bool isPrintMenuOpen = false;

    protected override async Task OnInitializedAsync()
    {
        cases = await CaseService.GetAllCasesAsync();
        if (cases != null && cases.Any())
        {
            selectedCase = cases.First();
        }
    }
    
    private void SelectCase(Fir item)
    {
        selectedCase = item;
    }

    private void ToggleFileMenu()
    {
        isFileMenuOpen = !isFileMenuOpen;
        if (isFileMenuOpen) 
        {
            isHelpMenuOpen = false;
            isPrintMenuOpen = false;
        }
    }

    private void ToggleHelpMenu()
    {
        isHelpMenuOpen = !isHelpMenuOpen;
        if (isHelpMenuOpen) 
        {
            isFileMenuOpen = false;
            isPrintMenuOpen = false;
        }
    }

    private void TogglePrintMenu()
    {
        isPrintMenuOpen = !isPrintMenuOpen;
        if (isPrintMenuOpen) 
        {
            isFileMenuOpen = false;
            isHelpMenuOpen = false;
        }
    }
}




